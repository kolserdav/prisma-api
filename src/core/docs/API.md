# API документация

Документация вызовов для разработчика фронтенда.

## Ссылки

- [Инструкция по установке](../README.md)
- [Лог изменений](./CHANGELOG.md)
- [Инструкция для разработчика](./CONTRIBUTING.md)
- [Лицензия](../LICENSE.md)

## Введение

Всвязи с тем, что в проекте использован инновационный метод связи фронтенда и бекенда, а именно архитектура REST API сервера основана на `PrismaJS API`. Простыми словами, мы скопировали их название свойств, чтобы нам можно было работать над бизнес логикой, а не разрабатывать свои апи протоколы. Тем более это дает нам то, что фронтенд разработчик может сам выбирать фильтры для запроса, ориентируясь по примерам в секциях в документации `prisma`: [https://www.prisma.io/docs/concepts/components](https://www.prisma.io/docs/concepts/components).

## Языковые настройки

Для получения сообщения ответа от сервера на нужном языке, передаем заголовок `lang` с названием локали `en | ru | uk`. **На момент написания этого документа, все файлы локалей пока на английском `src/locales`**

## Авторизация

После аутентификациии по почте и паролю, или при регистрации, или при смене пароля, выдается `token`, который необходимо передавать в заголовке `Authorization` **каждого запроса требующего авторизации**:

```JSON
"Authorization" : "Bearer token"
```

## Пагинация

Пагинация работает при передаче в запросы `model.findMany` параметров `skip` (количества пропущенных элементов) и `take` (количество запрашиваемых элементов)
Например:

```typescript
userFindMany({
  where: {
    role: 'admin',
  },
  skip: 10, // Вернет начиная с 11-го элемента
  take: 10, // Вернет до 20 элемента включительно
});
```

Для удобства сервер возвращает доп параметры на такие вызовы: `take`, `count` и `skip`;
Для того чтобы получить нужный `skip` можно воспользоваться формулой:

```typescript
/*
  Параметры пагинации возвращаются в запросе и к ним прибавляется 
  count - количество всех которые удовлетворяют фильтрам
  ниже приведены формулы чтобы пагинацию можно было легко 
  составить и разобрать.
*/
const pageN = 2; //Номер страницы, которую запрашиваем
const take = 3; // необходимое количество
const skip = take * pageN - take; // получить skip зная номер страницы
// skip и take полученные из ответа
const pageN = (skip + take) / take; // получить номер страницы зная skip и take
```

## Фильтры и сортировки

Примеры фильтров и сортировок будут приводится в верху файла [../src/api.d.ts](../src/api.d.ts) в песочнице.

## API вызовы

Все запросы выполняются `POST` запросами, так как мы всё равно не используем запросы `GET`, так как нельзя передавать аргументы для `prisma` в строке, и нет необходимости его использовать, так как всё равно это не будет открываться в браузере. Поэтом от использования запросов `UPDATE` и `DELETE` тоже было решено отказаться, чтобы не путаться при копипасте, а ориентироваться по говорящим `url` запроса.

Чтобы не клонировать сюда одно и тоже, и держать API документацию всегда в актуальном состоянии, здесь приведены ссылки на файлы, которых должно хватить для фронтенд разработчика.

- Файлы директории [rest/remote](../rest/remote) - содержат примеры **готовых** (подробности в коментарии [src/api/api.d.ts](../src/api/api.d.ts) в секции `ИНТЕРФЕЙС ПРОГРАММИСТА ФРОНТЕНДА`) запросов на апи, также там есть запросы, которые не отражены в `api.d.ts` - потому что в нем только запросы по апи призма, а есть запросы, например по пользователю, где протоколы запроса не соответствую апи призма. **Локации файлов в `rest/remote` соответствуют апи на который ссылается файл, например: `/api/v1/user/findfirst` => `rest/user/findfirst.http`**.
- Файл [src/api/api.d.ts](../src/api/api.d.ts) - содержит объявления типизированных методов без реализации, с песочницей (при использовании IDE VSCode).
- Файл [src/index.js](../src/index.js) если предыдущих двух файлов недостаточно для понимания, например правил авторизации, можно посмотреть этот файл, особенно если есть какой-нибудь опыт с `ExpressJS`.
- Файлы обработчиков запроса при нажатии в `src/index.ts` на `Ctrl+L Mouse` по обработчику запроса, например `user.findFirst` откроется обработчик и в интерфейсе обработчика `Args`, вверху файла, можно увидеть актуальный тип ожидаемых параметров.

## Результаты ответов

```typescript
// статусы для определения получены ли данные и для окрашивания сообщений,
// например: зеленый | желтый | красный.
type Status = 'error' | 'warning' | 'success';

interface Result<T> {
  status: Status; // Если статус success значит данные получены иначе data === null
  message: string; // Сообщение которое можно выводить пользователю на его языке
  data: null | T; // T - тип запрашиваемой модели
  // Дебаг
  stdErrMessage?: string; // Только в дев режиме для понимания что произошло
  code?: string; // Там где нужно быстро понять в чем причина, например email, чтобы подсветить пользователю нужное поле
  // Авторизация
  token?: string;
  // Пагинация
  skip?: number | null; // пропустить количество элементов
  take?: number | null; // максимальное количество результатов
  count?: number | null; // количество результатов всего, что соответствует фильтру запроса
}
```
